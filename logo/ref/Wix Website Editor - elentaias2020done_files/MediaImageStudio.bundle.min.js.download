!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("MediaImageStudio",[],e):"object"==typeof exports?exports.MediaImageStudio=e():t.MediaImageStudio=e()}("undefined"!=typeof self?self:this,(function(){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="https://static.parastorage.com/services/media-image-studio-opener/1.421.0/",r(r.s=17)}([function(t,e,r){var n={EventEmitter:r(6),EmitterSubscription:r(2)};t.exports=n},function(t,e,r){"use strict";const n=r(14),o=r(15),i=r(16);function s(t){if("string"!=typeof t||1!==t.length)throw new TypeError("arrayFormatSeparator must be single character string")}function a(t,e){return e.encode?e.strict?n(t):encodeURIComponent(t):t}function c(t,e){return e.decode?o(t):t}function u(t){const e=t.indexOf("#");return-1!==e&&(t=t.slice(0,e)),t}function p(t){const e=(t=u(t)).indexOf("?");return-1===e?"":t.slice(e+1)}function f(t,e){return e.parseNumbers&&!Number.isNaN(Number(t))&&"string"==typeof t&&""!==t.trim()?t=Number(t):!e.parseBooleans||null===t||"true"!==t.toLowerCase()&&"false"!==t.toLowerCase()||(t="true"===t.toLowerCase()),t}function l(t,e){s((e=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},e)).arrayFormatSeparator);const r=function(t){let e;switch(t.arrayFormat){case"index":return(t,r,n)=>{e=/\[(\d*)\]$/.exec(t),t=t.replace(/\[\d*\]$/,""),e?(void 0===n[t]&&(n[t]={}),n[t][e[1]]=r):n[t]=r};case"bracket":return(t,r,n)=>{e=/(\[\])$/.exec(t),t=t.replace(/\[\]$/,""),e?void 0!==n[t]?n[t]=[].concat(n[t],r):n[t]=[r]:n[t]=r};case"comma":case"separator":return(e,r,n)=>{const o="string"==typeof r&&r.split("").indexOf(t.arrayFormatSeparator)>-1?r.split(t.arrayFormatSeparator).map(e=>c(e,t)):null===r?r:c(r,t);n[e]=o};default:return(t,e,r)=>{void 0!==r[t]?r[t]=[].concat(r[t],e):r[t]=e}}}(e),n=Object.create(null);if("string"!=typeof t)return n;if(!(t=t.trim().replace(/^[?#&]/,"")))return n;for(const o of t.split("&")){let[t,s]=i(e.decode?o.replace(/\+/g," "):o,"=");s=void 0===s?null:["comma","separator"].includes(e.arrayFormat)?s:c(s,e),r(c(t,e),s,n)}for(const t of Object.keys(n)){const r=n[t];if("object"==typeof r&&null!==r)for(const t of Object.keys(r))r[t]=f(r[t],e);else n[t]=f(r,e)}return!1===e.sort?n:(!0===e.sort?Object.keys(n).sort():Object.keys(n).sort(e.sort)).reduce((t,e)=>{const r=n[e];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?t[e]=function t(e){return Array.isArray(e)?e.sort():"object"==typeof e?t(Object.keys(e)).sort((t,e)=>Number(t)-Number(e)).map(t=>e[t]):e}(r):t[e]=r,t},Object.create(null))}e.extract=p,e.parse=l,e.stringify=(t,e)=>{if(!t)return"";s((e=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},e)).arrayFormatSeparator);const r=r=>e.skipNull&&null==t[r]||e.skipEmptyString&&""===t[r],n=function(t){switch(t.arrayFormat){case"index":return e=>(r,n)=>{const o=r.length;return void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,[a(e,t),"[",o,"]"].join("")]:[...r,[a(e,t),"[",a(o,t),"]=",a(n,t)].join("")]};case"bracket":return e=>(r,n)=>void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,[a(e,t),"[]"].join("")]:[...r,[a(e,t),"[]=",a(n,t)].join("")];case"comma":case"separator":return e=>(r,n)=>null==n||0===n.length?r:0===r.length?[[a(e,t),"=",a(n,t)].join("")]:[[r,a(n,t)].join(t.arrayFormatSeparator)];default:return e=>(r,n)=>void 0===n||t.skipNull&&null===n||t.skipEmptyString&&""===n?r:null===n?[...r,a(e,t)]:[...r,[a(e,t),"=",a(n,t)].join("")]}}(e),o={};for(const e of Object.keys(t))r(e)||(o[e]=t[e]);const i=Object.keys(o);return!1!==e.sort&&i.sort(e.sort),i.map(r=>{const o=t[r];return void 0===o?"":null===o?a(r,e):Array.isArray(o)?o.reduce(n(r),[]).join("&"):a(r,e)+"="+a(o,e)}).filter(t=>t.length>0).join("&")},e.parseUrl=(t,e)=>({url:u(t).split("?")[0]||"",query:l(p(t),e)}),e.stringifyUrl=(t,r)=>{const n=u(t.url).split("?")[0]||"",o=e.extract(t.url),i=e.parse(o),s=function(t){let e="";const r=t.indexOf("#");return-1!==r&&(e=t.slice(r)),e}(t.url),a=Object.assign(i,t.query);let c=e.stringify(a,r);return c&&(c="?"+c),`${n}${c}${s}`}},function(t,e,r){"use strict";var n=function(t){function e(r,n,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),t.call(this,r),this.listener=n,this.context=o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),e}(r(7));t.exports=n},function(t,e,r){"use strict";t.exports=function(t,e,r,n,o,i,s,a){if(!t){var c;if(void 0===e)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var u=[r,n,o,i,s,a],p=0;(c=new Error(e.replace(/%s/g,(function(){return u[p++]})))).name="Invariant Violation"}throw c.framesToPop=1,c}}},function(t){t.exports=JSON.parse('{"a":"3.44.0"}')},function(t,e,r){var n=r(10);"string"==typeof n&&(n=[[t.i,n,""]]);var o={singleton:!0,hmr:!0,transform:void 0,insertInto:void 0};r(12)(n,o);n.locals&&(t.exports=n.locals)},function(t,e,r){"use strict";var n=r(2),o=r(8),i=r(9),s=r(3),a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriber=new o,this._currentSubscription=null}return t.prototype.addListener=function(t,e,r){return this._subscriber.addSubscription(t,new n(this._subscriber,e,r))},t.prototype.once=function(t,e,r){var n=this;return this.addListener(t,(function(){n.removeCurrentListener(),e.apply(r,arguments)}))},t.prototype.removeAllListeners=function(t){this._subscriber.removeAllSubscriptions(t)},t.prototype.removeCurrentListener=function(){this._currentSubscription||s(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.prototype.listeners=function(t){var e=this._subscriber.getSubscriptionsForType(t);return e?e.filter(i.thatReturnsTrue).map((function(t){return t.listener})):[]},t.prototype.emit=function(t){var e=this._subscriber.getSubscriptionsForType(t);if(e){for(var r=Object.keys(e),n=0;n<r.length;n++){var o=r[n],i=e[o];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.prototype.__emitToSubscription=function(t,e){var r=Array.prototype.slice.call(arguments,2);t.listener.apply(t.context,r)},t}();t.exports=a},function(t,e,r){"use strict";var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.subscriber=e}return t.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},t}();t.exports=n},function(t,e,r){"use strict";var n=r(3),o=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._subscriptionsForType={},this._currentSubscription=null}return t.prototype.addSubscription=function(t,e){e.subscriber!==this&&n(!1),this._subscriptionsForType[t]||(this._subscriptionsForType[t]=[]);var r=this._subscriptionsForType[t].length;return this._subscriptionsForType[t].push(e),e.eventType=t,e.key=r,e},t.prototype.removeAllSubscriptions=function(t){void 0===t?this._subscriptionsForType={}:delete this._subscriptionsForType[t]},t.prototype.removeSubscription=function(t){var e=t.eventType,r=t.key,n=this._subscriptionsForType[e];n&&delete n[r]},t.prototype.getSubscriptionsForType=function(t){return this._subscriptionsForType[t]},t}();t.exports=o},function(t,e,r){"use strict";function n(t){return function(){return t}}var o=function(){};o.thatReturns=n,o.thatReturnsFalse=n(!1),o.thatReturnsTrue=n(!0),o.thatReturnsNull=n(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(t){return t},t.exports=o},function(t,e,r){(e=t.exports=r(11)(!1)).push([t.i,"._1NZ04{position:fixed;top:0;left:0;z-index:6001;width:100%;height:100%;border:0}\n",""]),e.locals={mediaImageStudio:"_1NZ04"}},function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",n=t[3];if(!n)return r;if(e&&"function"==typeof btoa){var o=(s=n,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),i=n.sources.map((function(t){return"/*# sourceURL="+n.sourceRoot+t+" */"}));return[r].concat(i).concat([o]).join("\n")}var s;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r})).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];null!=i&&(n[i]=!0)}for(o=0;o<t.length;o++){var s=t[o];null!=s[0]&&n[s[0]]||(r&&!s[2]?s[2]=r:r&&(s[2]="("+s[2]+") and ("+r+")"),e.push(s))}},e}},function(t,e,r){var n,o,i={},s=(n=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===o&&(o=n.apply(this,arguments)),o}),a=function(t,e){return e?e.querySelector(t):document.querySelector(t)},c=function(t){var e={};return function(t,r){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t,r);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),u=null,p=0,f=[],l=r(13);function d(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=i[n.id];if(o){o.refs++;for(var s=0;s<o.parts.length;s++)o.parts[s](n.parts[s]);for(;s<n.parts.length;s++)o.parts.push(b(n.parts[s],e))}else{var a=[];for(s=0;s<n.parts.length;s++)a.push(b(n.parts[s],e));i[n.id]={id:n.id,refs:1,parts:a}}}}function m(t,e){for(var r=[],n={},o=0;o<t.length;o++){var i=t[o],s=e.base?i[0]+e.base:i[0],a={css:i[1],media:i[2],sourceMap:i[3]};n[s]?n[s].parts.push(a):r.push(n[s]={id:s,parts:[a]})}return r}function h(t,e){var r=c(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=f[f.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),f.push(e);else if("bottom"===t.insertAt)r.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(t.insertAt.before,r);r.insertBefore(e,o)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=f.indexOf(t);e>=0&&f.splice(e,1)}function v(t){var e=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var n=function(){0;return r.nc}();n&&(t.attrs.nonce=n)}return g(e,t.attrs),h(t,e),e}function g(t,e){Object.keys(e).forEach((function(r){t.setAttribute(r,e[r])}))}function b(t,e){var r,n,o,i;if(e.transform&&t.css){if(!(i="function"==typeof e.transform?e.transform(t.css):e.transform.default(t.css)))return function(){};t.css=i}if(e.singleton){var s=p++;r=u||(u=v(e)),n=O.bind(null,r,s,!1),o=O.bind(null,r,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",g(e,t.attrs),h(t,e),e}(e),n=I.bind(null,r,e),o=function(){y(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(e),n=E.bind(null,r),o=function(){y(r)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=m(t,e);return d(r,e),function(t){for(var n=[],o=0;o<r.length;o++){var s=r[o];(a=i[s.id]).refs--,n.push(a)}t&&d(m(t,e),e);for(o=0;o<n.length;o++){var a;if(0===(a=n[o]).refs){for(var c=0;c<a.parts.length;c++)a.parts[c]();delete i[a.id]}}}};var w,S=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function O(t,e,r,n){var o=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=S(e,o);else{var i=document.createTextNode(o),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(i,s[e]):t.appendChild(i)}}function E(t,e){var r=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function I(t,e,r){var n=r.css,o=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(n=l(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var s=new Blob([n],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var o,i=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(i)?t:(o=0===i.indexOf("//")?i:0===i.indexOf("/")?r+i:n+i.replace(/^\.\//,""),"url("+JSON.stringify(o)+")")}))}},function(t,e,r){"use strict";t.exports=t=>encodeURIComponent(t).replace(/[!'()*]/g,t=>"%"+t.charCodeAt(0).toString(16).toUpperCase())},function(t,e,r){"use strict";var n=new RegExp("%[a-f0-9]{2}","gi"),o=new RegExp("(%[a-f0-9]{2})+","gi");function i(t,e){try{return decodeURIComponent(t.join(""))}catch(t){}if(1===t.length)return t;e=e||1;var r=t.slice(0,e),n=t.slice(e);return Array.prototype.concat.call([],i(r),i(n))}function s(t){try{return decodeURIComponent(t)}catch(o){for(var e=t.match(n),r=1;r<e.length;r++)e=(t=i(e,r).join("")).match(n);return t}}t.exports=function(t){if("string"!=typeof t)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch(e){return function(t){for(var e={"%FE%FF":"\ufffd\ufffd","%FF%FE":"\ufffd\ufffd"},r=o.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch(t){var n=s(r[0]);n!==r[0]&&(e[r[0]]=n)}r=o.exec(t)}e["%C2"]="\ufffd";for(var i=Object.keys(e),a=0;a<i.length;a++){var c=i[a];t=t.replace(new RegExp(c,"g"),e[c])}return t}(t)}}},function(t,e,r){"use strict";t.exports=(t,e)=>{if("string"!=typeof t||"string"!=typeof e)throw new TypeError("Expected the arguments to be of type `string`");if(""===e)return[t];const r=t.indexOf(e);return-1===r?[t]:[t.slice(0,r),t.slice(r+e.length)]}},function(t,e,r){"use strict";r.r(e),r.d(e,"MediaImageStudio",(function(){return _})),r.d(e,"MediaImageStudioURL",(function(){return o})),r.d(e,"MediaImageStudioEvents",(function(){return g})),r.d(e,"MediaImageStudioMode",(function(){return f})),r.d(e,"SaveStrategy",(function(){return m})),r.d(e,"SegmentationType",(function(){return h})),r.d(e,"CropRatio",(function(){return c}));var n={};r.r(n),r.d(n,"encode",(function(){return E})),r.d(n,"decode",(function(){return I}));var o,i=function(){return(i=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function s(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]])}return r}!function(t){t.Prod="https://manage.wix.com/media-image-studio",t.ProdEditorX="https://manage.editorx.com/media-image-studio",t.Local="http://local.wix.com:3010"}(o||(o={}));var a,c,u,p,f,l,d,m,h,y,v=r(4);!function(t){t.UpdateSettings="updateSettings",t.IframeRequested="iframeRequested",t.IframeAppeared="iframeAppeared",t.IframeDisappeared="iframeDisappeared"}(a||(a={})),function(t){t.Free="free",t.Original="original",t.Square="square",t.R16_9="16:9",t.R4_3="4:3",t.R3_2="3:2"}(c||(c={})),function(t){t.FreeRotate="freeRotate",t.Crop="crop",t.AspectRatio="aspectRatio",t.Orientation="orientation",t.None="none"}(u||(u={})),function(t){t.Private="private",t.PrivateUser="privateUser",t.Public="public"}(p||(p={})),function(t){t.Default="",t.Transform="transform",t.Filters="filters",t.Adjust="adjust",t.Cutout="cutout"}(f||(f={})),function(t){t.v1_0="1.0.1",t.v1_1="1.1",t.v1_3="1.3",t.v1_4="1.4"}(l||(l={})),function(t){t.Predefined="predefined",t.Private="private",t.Public="public",t.Unsplash="unsplash",t.Unknown="unknown"}(d||(d={})),function(t){t.Default="default",t.Upload="upload"}(m||(m={})),function(t){t.Portrait="Portrait",t.Object="Object",t.Logo="Logo",t.None="None"}(h||(h={})),function(t){t.Horizontal="horizontal_orientation",t.Vertical="vertical_orientation"}(y||(y={}));var g,b=r(0);!function(t){t.ImageData="imageData",t.UploadedFile="uploadedFile",t.Close="close"}(g||(g={}));var w=r(5);function S(t){var e,r;(new Image).src=(e=t,r=Math.random(),"//frog.wix.com/media-studio?src=94&"+Object.keys(e).filter((function(t){return void 0!==e[t]})).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(String(e[t]))})).join("&")+"&_="+r)}var O=r(1);function E(t){return O.stringify(Object.keys(t).reduce((function(e,r){var n;return e[r]="object"==typeof(n=t[r])?"@json"+JSON.stringify(n):n,e}),{}))}function I(t){void 0===t&&(t=location.search);var e=O.parse(t);return Object.keys(e).forEach((function(t){var r;e[t]=0===(r=e[t]).indexOf("@json")?JSON.parse(r.slice("@json".length)):r})),e}function x(){return window.location.hostname.match(/editorx\.com$/)?o.ProdEditorX:o.Prod}var j,R=x();!function(t){t.FRAME_CLOSE="MEDIA_IMAGE_STUDIO.FRAME_CLOSE",t.IMAGE_DATA="MEDIA_IMAGE_STUDIO.IMAGE_DATA",t.UPLOADED_IMAGE="MEDIA_IMAGE_STUDIO.UPLOADED_IMAGE",t.READY="MEDIA_IMAGE_STUDIO.READY"}(j||(j={}));var T,F=["http://local.wix.com:3010","https://manage.wix.com","https://manage.editorx.com",""],U=function(){function t(t,e){var r=this;void 0===e&&(e={debug:!1,mediaRoot:"",initiator:""}),this.targetFrame=t,this.options=e,this.messagesEmitter=new b.EventEmitter,this.readyPromise=void 0,this.handleMessage=function(t){if(-1!==F.indexOf(t.origin)){var e=function(t){return t.data}(t);if(e)r.messagesEmitter.emit(e.type,e.data);else{var n=r.options;S({evid:36,action:"Invalid incoming message data",initiatorName:n.initiator,mediaRoot:n.mediaRoot})}}}}return t.prototype.init=function(){window.addEventListener("message",this.handleMessage),this.waitForReady().catch((function(t){console.error("There was an error waiting for ready",t)}))},t.prototype.destroy=function(){window.removeEventListener("message",this.handleMessage)},t.prototype.sendMessage=function(t){var e=this,r=this.targetFrame.contentWindow;if(!r)throw Error('can not send message "'+JSON.stringify(t)+'", no contentWindow');this.waitForReady().then((function(){r.postMessage(t,e.getTargetOrigin())})).catch((function(t){console.error("There was an error waiting for ready",t)}))},t.prototype.waitForMessage=function(t){var e=this;return new Promise((function(r){e.messagesEmitter.once(t,(function(t){r(t)}))}))},t.prototype.waitForClose=function(){return this.waitForMessage(j.FRAME_CLOSE)},t.prototype.waitForImageData=function(){var t=this;return new Promise((function(e){t.messagesEmitter.once(j.IMAGE_DATA,(function(t){var r=t.imageBuffer,n=t.mime;e(new Blob([new Uint8Array(r)],{type:n}))}))}))},t.prototype.waitForUploadedImage=function(){return this.waitForMessage(j.UPLOADED_IMAGE)},t.prototype.waitForReady=function(){return this.readyPromise||(this.readyPromise=this.waitForMessage(j.READY)),this.readyPromise},t.prototype.getTargetOrigin=function(){return this.options.debug?"http://local.wix.com:3010":R},t}();!function(t){t.Closed="closed",t.Opening="opening",t.Open="open"}(T||(T={}));var _=function(){function t(t){var e=t.url,r=void 0===e?x():e,n=t.appendTo,o=void 0===n?document.body:n,i=t.title,s=void 0===i?"Media Image Studio":i,a=t.saveStrategy,u=void 0===a?m.Default:a,l=t.targetFolder,d=t.segmentationType,y=void 0===d?h.Portrait:d,g=t.siteToken,w=t.mediaRoot,S=void 0===w?"":w,O=t.initiator,E=void 0===O?"Unknown":O,I=t.metasiteId,j=void 0===I?"":I,R=t.isUserLevelFile,F=void 0!==R&&R,U=t.mode,_=void 0===U?f.Default:U,A=t.fileId,M=t.fileSource,C=void 0===M?p.Private:M,L=t.defaultRatio,k=void 0===L?c.Free:L,D=t.isFixedRatio,N=void 0!==D&&D,P=t.locale,q=t.crop,B=t.instance,G=t.isSiteVisitorMode,$=t.metaSiteToken;this.transport=void 0,this.iframe=void 0,this.messageEmitter=new b.EventEmitter,this.requestId=0,this.mediaImageStudioState=T.Closed,this.iframeOptions={url:r,appendTo:o,title:s},this.permanentOptions={initiator:E,metasiteId:j,siteToken:g,metaSiteToken:$,mediaRoot:S,saveStrategy:u,segmentationType:y,isUserLevelFile:F,locale:P,instance:B,isSiteVisitorMode:G,openerVersion:v.a},this.showOptions={fileId:A,fileSource:C,mode:_,isFixedRatio:N,defaultRatio:k,crop:q,targetFolder:l}}return t.prototype.preload=function(){this.iframe||(this.iframe=this.init(this.showOptions),this.hide())},t.prototype.sendClose=function(){this.emitMessage({type:g.Close,payload:void 0})},t.prototype.hide=function(){this.iframe&&(this.sendClose(),window.clearTimeout(this.showTimeout),this.mediaImageStudioState=T.Closed,this.iframe.style.display="none",this.transport&&this.transport.sendMessage({type:a.IframeDisappeared,data:{requestId:this.requestId,ts:Date.now()}}))},t.prototype.kill=function(){if(this.iframe){window.clearTimeout(this.showTimeout);var t=this.iframe.parentNode;t&&t.removeChild(this.iframe),this.iframe=void 0,this.transport&&(this.transport.destroy(),this.transport=void 0),this.sendClose(),this.messageEmitter.removeAllListeners()}},t.needsSendOptions=function(t){return Object.keys(t).some((function(e){return void 0!==t[e]}))},t.prepareShowOptions=function(t){void 0===t&&(t={});var e=t.fileId,r=t.fileUrl,n=(t.isUpload,s(t,["fileId","fileUrl","isUpload"]));return e?i({fileId:e},n):r?i({fileUrl:r},n):t},t.prototype.trackOpenStarted=function(t){void 0===t&&(t={});var e=this.permanentOptions,r=e.mediaRoot,n=e.openerVersion,o=e.initiator;S({evid:95,entryPoint:t.mode||"",fileId:t.fileId||"",isSFS:Boolean(t.isUpload),mediaRoot:r,openerVersion:n,initiatorName:o})},t.prototype.show=function(e){var r=this;if(void 0===e&&(e={}),this.mediaImageStudioState===T.Closed){this.mediaImageStudioState=T.Opening,this.trackOpenStarted(e);var n=t.prepareShowOptions(e);this.requestId=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);var o=Date.now(),i=Boolean(this.iframe)&&t.needsSendOptions(n);this.iframe||(this.iframe=this.init(n));var s=this.iframe;if(i){if(!this.transport)throw Error("transport is not created when showing iframe");this.transport.sendMessage({type:a.UpdateSettings,data:n})}this.transport||(this.transport=this.initTransport(s)),this.transport.sendMessage({type:a.IframeRequested,data:{requestId:this.requestId,ts:o}}),this.transport.waitForClose().then((function(){r.hide()})).catch((function(t){console.error("Error waiting for close",t)})),this.transport.waitForImageData().then((function(t){r.emitMessage({type:g.ImageData,payload:t})})).catch((function(t){console.error("Error waiting for image",t)})),this.transport.waitForUploadedImage().then((function(t){r.emitMessage({type:g.UploadedFile,payload:t})})).catch((function(t){console.error("Error waiting for upload image",t)})),this.showTimeout=window.setTimeout((function(){var t=Date.now();if(!r.transport)throw new Error("transport is not inited");r.transport.sendMessage({type:a.IframeAppeared,data:{requestId:r.requestId,ts:t}}),r.mediaImageStudioState=T.Open,s.style.display="block";var e=s.contentWindow;e&&e.focus()}),100)}},t.prototype.on=function(t,e){return this.messageEmitter.addListener(t,e)},t.prototype.once=function(t,e){return this.messageEmitter.once(t,e)},t.prototype.emitMessage=function(t){this.messageEmitter.emit(t.type,t.payload)},t.prototype.getURL=function(t){return function(t,e,r){var o=t.replace(/\/$/,""),a=r.mode,c=s(r,["mode"]);void 0!==a&&a!==f.Default&&(o=o+"/"+a);var u=i(i({},e),c);return o+"?"+n.encode(u)}(this.iframeOptions.url,this.permanentOptions,t)},t.prototype.initTransport=function(t){var e,r,n=this.permanentOptions,i=n.mediaRoot,s=n.initiator,a=(e=t,void 0===(r={debug:this.iframeOptions.url===o.Local,mediaRoot:i,initiator:s})&&(r={debug:!1,mediaRoot:"",initiator:""}),new U(e,r));return a.init(),a},t.prototype.init=function(t){this.permanentOptions.isUserLevelFile&&console.warn("isUserLevelFile is deprecated. Use fileSource=FileSource.PrivateUser instead");var e=document.createElement("iframe");return e.src=this.getURL(t),e.id="mediaImageStudio",e.className=w.mediaImageStudio,e.title=this.iframeOptions.title,this.iframeOptions.appendTo.appendChild(e),this.transport=this.initTransport(e),e},t}();e.default=_}])}));
//# sourceMappingURL=MediaImageStudio.bundle.min.js.map