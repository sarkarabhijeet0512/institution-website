(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.elementorySupport=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){"use strict";var elementorySupportFactory=require(".");module.exports=elementorySupportFactory()},{".":3}],2:[function(require,module,exports){"use strict";module.exports={PARSE:"parsererror",ERROR:"error",ABORT:"abort",TIMEOUT:"timeout"}},{}],3:[function(require,module,exports){"use strict";function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var _require=require("@wix/cloud-elementory-client-core"),serialize=_require.serialize,deserialize=_require.deserialize,getPathWithBaseUrl=require("./paths"),errorTypes=require("./error-types"),THIRTY_SECONDS=3e4;module.exports=function(e,r,t){return{baseUrl:e,queryParameters:r,currentPath:t,options:arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},errorTypes:errorTypes,getJSON:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],t=this.currentPath?location.href.replace(this.currentPath,e):getPathWithBaseUrl(this.baseUrl,e,this.queryParameters),o=this.options,n=o.headers,i=void 0===n?{}:n,s=o.withCredentials,a=void 0!==s&&s,u=o.timeout,c=void 0===u?THIRTY_SECONDS:u,p=_objectSpread({},i,{"Content-Type":"application/json"});return new Promise(function(e,o){var n=new XMLHttpRequest;function i(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=new Error(r);return t.xhr=n,t.errorType=e,t}n.withCredentials=a;var s=setTimeout(function(){o(i(errorTypes.TIMEOUT)),n.abort()},c);n.open("POST",t,!0),n.onerror=function(){return o(i(errorTypes.ERROR,n.statusText))},n.onreadystatechange=function(){if(4===n.readyState)if(clearTimeout(s),200===n.status)try{var r=deserialize(n.responseText),t=r.isError,a=r.payload;t?o(a):e(a)}catch(e){o(i(errorTypes.PARSE,e.message))}else{var u=n.status?errorTypes.ERROR:errorTypes.ABORT;o(i(u,n.statusText))}},Object.keys(p).forEach(function(e){return n.setRequestHeader(e,p[e])}),n.send(serialize(r))})}}}},{"./error-types":2,"./paths":4,"@wix/cloud-elementory-client-core":6}],4:[function(require,module,exports){"use strict";var sanitize=function(t){return t.startsWith("?")||t.startsWith("&")?t.substr(1):t};module.exports=function(t,n,c){if(!c)return t+n;var r=sanitize(c);return-1===n.indexOf("?")?"".concat(t).concat(n,"?").concat(r):"".concat(t).concat(n,"&").concat(r)}},{}],5:[function(require,module,exports){"use strict";var _require=require("@wix/cloud-elementory-protocol"),convertFromCustomFormat=_require.convertFromCustomFormat,convertToErrorObject=function(r){var e=new Error(r.message);return e.stack=r.stack,e.name=r.name,e.code=r.code,e},deserialize=function(r){var e=convertFromCustomFormat(JSON.parse(r)),o=e.result;return{isError:!!e.exception,payload:o&&o._elementoryError?convertToErrorObject(o):o}};module.exports={deserialize:deserialize}},{"@wix/cloud-elementory-protocol":12}],6:[function(require,module,exports){"use strict";var _require=require("./serialize"),serialize=_require.serialize,_require2=require("./deserialize"),deserialize=_require2.deserialize;module.exports={serialize:serialize,deserialize:deserialize}},{"./deserialize":5,"./serialize":7}],7:[function(require,module,exports){"use strict";function _toConsumableArray(r){return _arrayWithoutHoles(r)||_iterableToArray(r)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(r){if(Symbol.iterator in Object(r)||"[object Arguments]"===Object.prototype.toString.call(r))return Array.from(r)}function _arrayWithoutHoles(r){if(Array.isArray(r)){for(var e=0,t=new Array(r.length);e<r.length;e++)t[e]=r[e];return t}}var _require=require("@wix/cloud-elementory-protocol"),convertToCustomFormat=_require.convertToCustomFormat,serialize=function(r){return JSON.stringify(convertToCustomFormat(_toConsumableArray(r)))};module.exports={serialize:serialize}},{"@wix/cloud-elementory-protocol":12}],8:[function(require,module,exports){"use strict";function _classCallCheck(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,r){for(var e=0;e<r.length;e++){var o=r[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,r,e){return r&&_defineProperties(t.prototype,r),e&&_defineProperties(t,e),t}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var _require=require("../mapValues"),mapValues=_require.mapValues,isObjectButNotNull=function(t){return null!==t&&"object"===_typeof(t)},ConvertersComposer=function(){function t(){_classCallCheck(this,t);for(var r=arguments.length,e=new Array(r),o=0;o<r;o++)e[o]=arguments[o];this._converters=e}return _createClass(t,[{key:"convertToCustomFormat",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(isObjectButNotNull(t)){if(r.has(t))throw new TypeError("Converting circular structure to JSON");r.add(t)}if(Array.isArray(t))return this._convertArray(t,r);var o=this._findConverterToCustomFormat(t).convertToCustomFormat(t,e);return isObjectButNotNull(t)?this._convertObject(o,t,r):o}},{key:"convertFromCustomFormat",value:function(t){var r=this,e=t;return Array.isArray(t)?e=t.map(function(t){return r.convertFromCustomFormat(t)}):isObjectButNotNull(t)&&(e=mapValues(t,this.convertFromCustomFormat.bind(this))),this._findConverterFromCustomFormat(e).convertFromCustomFormat(e)}},{key:"_convertObject",value:function(t,r,e){var o,n=this;return o="function"==typeof t.toJSON?mapValues(t.toJSON(),function(t){return n.convertToCustomFormat(t,e)}):mapValues(t,function(t){return n.convertToCustomFormat(t,e)}),e.delete(r),o}},{key:"_convertArray",value:function(t,r){var e=this,o=t.map(function(t){return e.convertToCustomFormat(t,r,!0)});return r.delete(t),o}},{key:"_findConverterFromCustomFormat",value:function(t){return this._converters.find(function(r){return r.canConvertFromCustomFormat(t)})}},{key:"_findConverterToCustomFormat",value:function(t){return this._converters.find(function(r){return r.canConvertToCustomFormat(t)})}}]),t}();module.exports={ConvertersComposer:ConvertersComposer}},{"../mapValues":13}],9:[function(require,module,exports){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var DateConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canConvertToCustomFormat",value:function(e){return e instanceof Date}},{key:"convertToCustomFormat",value:function(e){return{$date:e.toISOString()}}},{key:"canConvertFromCustomFormat",value:function(e){return e&&"object"===_typeof(e)&&"$date"in e}},{key:"convertFromCustomFormat",value:function(e){return new Date(e.$date)}}]),e}();module.exports={DateConverter:DateConverter}},{}],10:[function(require,module,exports){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}var DefaultConverter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"canConvertToCustomFormat",value:function(){return!0}},{key:"convertToCustomFormat",value:function(e,r){return r&&void 0===e?null:e}},{key:"canConvertFromCustomFormat",value:function(){return!0}},{key:"convertFromCustomFormat",value:function(e){return e}}]),e}();module.exports={DefaultConverter:DefaultConverter}},{}],11:[function(require,module,exports){"use strict";var _require=require("./DefaultConverter"),DefaultConverter=_require.DefaultConverter,_require2=require("./DateConverter"),DateConverter=_require2.DateConverter,_require3=require("./ConvertersComposer"),ConvertersComposer=_require3.ConvertersComposer,composedConverters=new ConvertersComposer(new DateConverter,new DefaultConverter);module.exports={convertToCustomFormat:function(e){return composedConverters.convertToCustomFormat(e)},convertFromCustomFormat:function(e){return composedConverters.convertFromCustomFormat(e)}}},{"./ConvertersComposer":8,"./DateConverter":9,"./DefaultConverter":10}],12:[function(require,module,exports){"use strict";var _require=require("../lib/converter"),convertToCustomFormat=_require.convertToCustomFormat,convertFromCustomFormat=_require.convertFromCustomFormat,_require2=require("../lib/web-method-protocol"),resultToWebMethodPayload=_require2.resultToWebMethodPayload,exceptionToWebMethodPayload=_require2.exceptionToWebMethodPayload;module.exports={convertToCustomFormat:convertToCustomFormat,convertFromCustomFormat:convertFromCustomFormat,resultToWebMethodPayload:resultToWebMethodPayload,exceptionToWebMethodPayload:exceptionToWebMethodPayload}},{"../lib/converter":11,"../lib/web-method-protocol":14}],13:[function(require,module,exports){"use strict";function mapValues(a,e){var u={};return Object.keys(a).forEach(function(r){var s=e(a[r]);void 0!==s&&(u[r]=s)}),u}module.exports={mapValues:mapValues}},{}],14:[function(require,module,exports){"use strict";var _require=require("../converter"),convertToCustomFormat=_require.convertToCustomFormat,resultToWebMethodPayload=function(e,o){var t=o?JSON.parse(JSON.stringify(e,o)):convertToCustomFormat(e);return void 0===t?{}:{result:t}},exceptionToWebMethodPayload=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return""};return{result:e instanceof Error?{message:o(e.message),name:e.name,stack:t(e.stack),code:e.code,_elementoryError:!0}:e,exception:!0}};module.exports={resultToWebMethodPayload:resultToWebMethodPayload,exceptionToWebMethodPayload:exceptionToWebMethodPayload}},{"../converter":11}]},{},[1])(1)});