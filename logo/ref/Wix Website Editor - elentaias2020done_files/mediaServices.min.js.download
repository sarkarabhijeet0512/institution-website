define("mediaServices",["tslib","lodash","util","constants","stateManagement","coreBi","experiment","santa-core-utils","image-client-api","MediaImageStudio","videoMakerOpener","UserFeedbackOpener","media-manager-api"],(function(e,t,a,i,n,o,r,s,d,c,u,l,p){return function(e){var t={};function a(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,i){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(a.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(i,n,function(t){return e[t]}.bind(null,n));return i},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1826)}({0:function(t,a){t.exports=e},1:function(e,a){e.exports=t},12:function(e,t){e.exports=o},13:function(e,t){e.exports=r},149:function(e,t){e.exports=d},17:function(e,t){e.exports=s},1826:function(e,t,a){var i,n;i=[a,t,a(0),a(1),a(6),a(2),a(7),a(1827),a(149),a(189),a(262),a(263),a(12),a(13),a(17)],void 0===(n=function(e,t,a,i,n,o,r,s,d,c,u,l,p,m,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i=a.__importDefault(i),n=a.__importDefault(n),o=a.__importStar(o),r=a.__importDefault(r),s=a.__importDefault(s),d=a.__importDefault(d),c=a.__importStar(c),u=a.__importStar(u),l=a.__importStar(l),p=a.__importStar(p),m=a.__importDefault(m),f=a.__importDefault(f);const g=p.events.singleVideoPlayer,{backgroundUtils:h}=o,{getMediaPlayerVideoObject:_,getChangeVideoBiEventFields:S,getStoryboardDisplayValue:y}=h,b=r.default.editorPlugins.userPreferences.actions.setSessionUserPreferences,v=r.default.editorPlugins.userPreferences.selectors.getSessionUserPreferences,{getMediaPath:M}=r.default.editorPlugins.userPreferences.selectors,{CLIPART_DATA_KEYS:k}=n.default,{VECTOR_IMAGE_CATEGORY:I,VECTOR_SHAPE_DEFAULT_PATH:T,VECTOR_ART_DEFAULT_PATH:w}=n.default.VECTOR_IMAGE_DEFAULTS,P="public/5d54b10e-e5e3-416b-9a2f-9316773f2a5b/078ecd58-f828-44f6-ac91-8cafbf5dbdae",E="public/8e256233-1752-4026-9341-54036e7f875e/d6b6b972-952c-4ab0-b46a-a6c05a0a94a5",{MediaImageStudioEvents:O,MediaImageStudioMode:x}=c;function A(e){const t=e.split("/");return 2===t.length?parseFloat(t[0])/parseFloat(t[1]):parseFloat(t[0])}function C(e){return A(e)>50}function F(e){return e&&C(e)?30/A(e):1}function R(e,t){const a=i.default.includes(t,"alpha"),n=i.default.cloneDeep(e);return a?(n.cssStyle={cssBorder:null,cssBorderRadius:null,cssBoxShadow:null},n.background.imageOverlay=null,n.background.colorOverlay=""):n.background.filterEffect=null,n}t.create=e=>{function t(t,a){const n=o.imageTransform.fittingTypes,r=e.components.data.get(t),s=e.components.layout.get(t),c=e.components.properties.get(t).displayMode,{width:u,height:l}=a,p={width:u,height:l,uri:a.id,name:a.name,alt:a.name,crop:null,focalPoint:null,originalImageDataRef:null};if(r.crop&&e.imageCrop.isCropAllowed(p.uri)&&!o.url.isExternalUrl(p.uri)){const e=function(e,t,a,i,n){if(n===d.default.fittingTypes.SCALE_TO_FILL||n===d.default.fittingTypes.LEGACY_FULL){const n=Math.min(a/e,i/t),o=e*n,r=t*n;return{width:Math.round(o),height:Math.round(r),x:Math.round((a-o)/2),y:Math.round((i-r)/2)}}return null}(s.width,s.height,u,l,c);p.crop=i.default.assign({},r.crop,e)}e.components.data.update(t,p,!0),c===o.imageTransform.fittingTypes.LEGACY_FULL&&e.components.properties.update(t,{displayMode:n.SCALE_TO_FILL},!0)}function a(t,a){const i=e.mediaServices.mediaStudio,o=i.once(O.UploadedFile,e=>{a(e),n()}),r=i.once(O.Close,()=>{o.remove(),r.remove()});i.show({fileId:t.imageFileId,mode:x.Adjust,initiator:t.initiator})}function n(){const e=window.document.querySelector("#editor");if(e){const t=window.document,a=t.documentElement.scrollTop||t.body.scrollTop;e.focus(),t.documentElement.scrollTop=t.body.scrollTop=a}}function p(){return m.default.isOpen("specs.media.MediaManager3")||m.default.isOpen("specs.media.MediaManager3Migrate")?e.dsRead.generalInfo.media.getSiteUploadToken():e.dsRead.generalInfo.getSiteToken()}return{initMediaManager:t=>{e.mediaServices.mediaManager=s.default.create(i.default.assign(t,{origin:s.default.origins.EDITOR}))},mediaManager:null,initMediaStudio:t=>{const a=c.default;e.mediaServices.mediaStudio=new a(t)},mediaStudio:null,initVideoMaker:()=>{e.mediaServices.videoMaker=new u.VideoMakerOpener},videoMaker:null,initUserFeedback:t=>{const a=l.default;e.mediaServices.userFeedback=new a(t)},userFeedback:null,hasSlowMo:C,getPlaybackSpeedByFPS:F,setFocusToEditor:n,changeWPhoto:function(a){const r=e.components.data.get(a),{dispatch:s,getState:d}=e.store,c=d(),u=M(r.uri)(c);e.mediaServices.mediaManager.open(e.mediaServices.mediaManager.categories.IMAGE,"change_image",{translation:{title:o.translate("Image_Media_Choose_Image"),submitButton:o.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:u,multiSelect:!1,callback(o,r){if(!o)return;const{width:d,height:c,fileName:u,title:l}=i.default.head(o);s(b("last_media_path_".concat(u),r.path)),t(a,{width:d,height:c,id:u,name:l}),e.history.add("Change Image"),n()}})},changeVectorImage:function(t,a,r,s){const d=e.store.getState(),c=e.components.data.get(t),u=i.default.get(c,["svgId"]),l=e.media.vectorImage.getSvgInfoFromCache(u).svgType,p="shape"===l?T:w,m="shape"===l?"change_basic_shape":"change_vector_art",f=M(u)(d)||r||p;e.mediaServices.mediaManager.open(e.mediaServices.mediaManager.categories[a||I],m,{multiSelect:!1,callback(a,r){if(i.default.isEmpty(a))return;const d=i.default.get(a,[0,"title"],""),u=i.default.get(a,[0,"uri"]);o.vectorImageUtils.replaceVectorImage(e,t,c,d,u,s),e.store.dispatch(b("last_media_path_".concat(u),r.path||"")),n()},path:f})},changeClipArt:function(t,a){const r=e.components.data.get(t),s=e.store.getState(),d=M(r.uri)(s);e.mediaServices.mediaManager.open(a,{multiSelect:!1,translation:{submitButton:o.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:d,callback(a,o){if(!a)return;const r=i.default.pick(a[0],k);r.uri=a[0].fileName,r.originalImageDataRef=null,r.crop=null,e.store.dispatch(b("last_media_path_".concat(r.uri),o.path)),e.components.data.update(t,r,!0),e.history.add("Change Clipart"),n()}})},changeVideo:function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.mediaServices.mediaManager.categories.VIDEO;const{dispatch:s,getState:d}=e.store,c=e.components.design.get(t),u=i.default.get(c.background,"mediaRef",{}),l=e.components.properties.get(t),p={id:t.id,type:"MOBILE"},m=e.components.properties.get(p),f=e.components.layout.get(t),h=u.videoId,M=u.mediaFeatures||[],k=i.default.includes(M,"alpha")?P:E,I=v("last_media_path_".concat(h))(d())||k;e.mediaServices.mediaManager.open(a,"change_video_box",{multiSelect:!1,callback(a,d){if(!a)return;const h=i.default.head(a),v=_(h,d),M=i.default.includes(v.mediaFeatures,"alpha");if(M){const{width:a,height:n}=i.default.maxBy(v.qualities,"width")||{},r=a/n,s=e.dsRead.components.layout.getLimits(i.default.isArray(t)?t[0]:t),d=i.default.assign({},s,f),c=o.layoutUtils.getLayoutWithAspectRatio(d,r,null);e.components.layout.update(t,c,!0)}const k=R(c,v.mediaFeatures);k.background.mediaRef=v;let I=!1;M?k.background.mediaRef.mask=null:(I=u.mask&&u.mask.svgId,I&&(k.background.mediaRef.mask=u.mask)),e.components.design.update(t,k,!0);const T={};i.default.get(l,"autoplay")&&i.default.assign(T,{autoplay:!0,mute:!0}),e.components.properties.update(t,T);const w=m&&m.overrideMask;if(w){const t={};t.overrideMask=M?null:m.overrideMask,e.components.properties.update(p,t)}const P=e.components.getChildren(t),E=i.default.find(P,(function(t){return"wysiwyg.viewer.components.MediaControls"===e.components.getType(t)})),O=e.components.properties.get(E),x=i.default.get(O,"showStoryboard");O.showStoryboard=y(v,x),e.components.properties.update(E,O,!0),e.history.add("Change Video"),e.store.dispatch(r.default.editorPlugins.bi.actions.event(g.video_player_video_changed,S(a[0],"video_player_gfpp",{hasMask:I||w}))),s(b("last_media_path_".concat(v.videoId),d.path||"")),n()},path:I})},changeShape:function(t){const{mediaServices:a}=e;a.mediaManager.open(a.mediaManager.categories.SHAPE,"change_basic_shape",{multiSelect:!1,callback(a){if(i.default.isEmpty(a))return;const r=o.svgUrlParser.parseSvgSkinFromUrl(a[0].fileUrl),s=e.components.style.get(t);r!==s.skin&&(s.skin=r,e.components.style.update(t,s),e.history.add("Change Shape"),n())},translation:{submitButton:o.translate("Shape_Media_Change_Shape")}})},adjustWPhoto:function(o,r){a({imageFileId:e.components.data.get(o).uri,initiator:r},a=>{const{width:r,height:s,id:d,name:c}=a;var u;t(o,{width:r,height:s,id:d,name:(u=c,i.default.truncate(u,{length:40,omission:""}))}),e.history.add("Adjust Image"),n()})},adjustImageX:function(t,a){return new Promise(i=>{const o=e.mediaServices.mediaStudio,r=e.components.data.get(t).image,s=o.once(O.UploadedFile,e=>{n();const{width:t,height:a,id:o}=e;i({width:t,height:a,uri:o})}),d=o.once(O.Close,()=>{s.remove(),d.remove()});o.show({fileId:r.uri,mode:x.Adjust,initiator:a})})},openMediaStudio:a,getSiteUploadToken:p,transferMediaItems:function(e,t){const a=p(),n=e.map(e=>({item_id:e,item_type:"file"})),o=i.default.chunk(n,100);return Promise.all(o.map(e=>{return i={destination:{site_token:a},site_token:t,items:e},f.default.requestsUtil.fetch("".concat("//files.wix.com","/site/media/editor/copy"),{method:"POST",credentials:"include",headers:new Headers({"content-type":"application/json; charset=utf-8"}),body:JSON.stringify(i)});var i}))}}}}.apply(t,i))||(e.exports=n)},1827:function(e,t){e.exports=p},189:function(e,t){e.exports=c},2:function(e,t){e.exports=a},262:function(e,t){e.exports=u},263:function(e,t){e.exports=l},6:function(e,t){e.exports=i},7:function(e,t){e.exports=n}})}));
//# sourceMappingURL=mediaServices.min.js.map